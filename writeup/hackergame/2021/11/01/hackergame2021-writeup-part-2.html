<!DOCTYPE html>
<html lang="en">
<!-- Beautiful Jekyll 5.0.0 | Copyright Dean Attali 2020 -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

  

  <title>Hackergame 2021 Writeup Part 2(Easy level)</title>

  

  <meta name="description" content="This part of writeup contains tasks that require a bit programming &amp;amp; linux experience. 卖瓜 It’s obvious that, you can’t get exactly 20 with some 6 and 9. So there must be some magic that can help us achieve it. As the task said, if the result becomes a float...">

  

  

  <link rel="alternate" type="application/rss+xml" title="Cat Munch" href="/web/feed.xml">

  

  

  


  
    
      
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">


    
      
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">


    
  

  
    
      <link rel="stylesheet" href="/web/assets/css/bootstrap-social.css">
    
      <link rel="stylesheet" href="/web/assets/css/beautifuljekyll.css">
    
  

  

  
  
  

  

  
  <meta property="og:site_name" content="Cat Munch">
  <meta property="og:title" content="Hackergame 2021 Writeup Part 2(Easy level)">
  <meta property="og:description" content="This part of writeup contains tasks that require a bit programming &amp;amp; linux experience. 卖瓜 It’s obvious that, you can’t get exactly 20 with some 6 and 9. So there must be some magic that can help us achieve it. As the task said, if the result becomes a float...">

  

  
  <meta property="og:type" content="article">
  <meta property="og:article:author" content="">
  <meta property="og:article:published_time" content="2021-11-01T00:00:00+00:00">
  <meta property="og:url" content="/web/writeup/hackergame/2021/11/01/hackergame2021-writeup-part-2.html">
  <link rel="canonical" href="/web/writeup/hackergame/2021/11/01/hackergame2021-writeup-part-2.html">
  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:site" content="@">
  <meta name="twitter:creator" content="@">

  <meta property="twitter:title" content="Hackergame 2021 Writeup Part 2(Easy level)">
  <meta property="twitter:description" content="This part of writeup contains tasks that require a bit programming &amp;amp; linux experience. 卖瓜 It’s obvious that, you can’t get exactly 20 with some 6 and 9. So there must be some magic that can help us achieve it. As the task said, if the result becomes a float...">

  

  


  

  

<script>MathJax={"tex":{"inlineMath":[["$","$"],["\\(","\\)"]],"displayMath":[["$$","$$"],["\\[","\\]"]]},"svg":{"fontCache":"global"}}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>


<body>

  


  <nav class="navbar navbar-expand-md navbar-light fixed-top navbar-custom top-nav-regular"><a class="navbar-brand" href="/web">Cat Munch</a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="main-navbar">
    <ul class="navbar-nav ml-auto"></ul>
  </div>

  

</nav>


  <!-- TODO this file has become a mess, refactor it -->







<header class="header-section ">

<div class="intro-header no-img">
  <div class="container-md">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
        <div class="post-heading">
          <h1>Hackergame 2021 Writeup Part 2(Easy level)</h1>
          

          
            <span class="post-meta">Posted on November 1, 2021</span>
            
            
          
        </div>
      </div>
    </div>
  </div>
</div>
</header>





<div class=" container-md ">
  <div class="row">
    <div class=" col-xl-8 offset-xl-2 col-lg-10 offset-lg-1 ">

      

      

      <article role="main" class="blog-post">
        <p>This part of writeup contains tasks that require a bit programming &amp; linux experience.</p>

<h2 id="卖瓜">卖瓜</h2>

<p>It’s obvious that, you can’t get exactly 20 with some 6 and 9. So there must be some magic that can help us achieve it.</p>

<p>As the task said, if the result becomes a float it will be invalid. But how can we turn it to a float?</p>

<p>I tried to put 3.3333 * 6 to the scale by changing the network packet but it didn’t work. So it may be something related to integer overflow.</p>

<p>Let’s try a $2^{63}$ level integer, $10^{18}$.</p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211102213220.png" alt=""></p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211102213252.png" alt=""></p>

<p>Surprisingly, after adding it twice, we turned it to a float.</p>

<p>So looks like if the weight on the scale exceeds the maximum 64-bit signed integer, it will turn to a float.</p>

<p>But if we type a bigger number like $10^{19}$ which already exceeded the limit, it will add nothing to the scale.</p>

<p>What about to type exactly the limit $2^{63}-1$? In the 6 jin field, it won’t work. But if in 9 jin field…</p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211102214817.png" alt=""></p>

<p>BOOOOOOM!</p>

<p>We make it overflow to negative.</p>

<p>And the absolute value of it can’t divide by 3. So after carefully increasing it back to positive, we can get a value which has a remainder of 1 when is divided 3.</p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211102215643.png" alt=""></p>

<p>Doing this again then we’ll get a remainder of 2.</p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211102215814.png" alt=""></p>

<p>Then just add a 6 and a 9, we’ll get 20.</p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211102215853.png" alt=""></p>

<h2 id="透明的文件">透明的文件</h2>

<p>Open the file, you’ll see something like <code class="language-plaintext highlighter-rouge">[39m[19;61H[9;12H</code>.</p>

<p>The format is quite similar to the thing we used to change linux terminal text color. Google it, and you’ll know it’s <a href="https://en.wikipedia.org/wiki/ANSI_escape_code">ANSI escape code</a>.</p>

<p>So let’s add <code class="language-plaintext highlighter-rouge">\033</code> before each <code class="language-plaintext highlighter-rouge">[</code>, which can be done with vim command <code class="language-plaintext highlighter-rouge">:s/\[/\\033\[/g</code>. And replace all invisible space character to other things like <code class="language-plaintext highlighter-rouge">#</code>.(can be done with <code class="language-plaintext highlighter-rouge">:s/\ /#/g</code> in vim)</p>

<p>Finally print it with echo -e, and you’ll get the flag.</p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211102221411.png" alt=""></p>

<h2 id="图之上的信息">图之上的信息</h2>

<p>According to the description of the task, we know that the website is using GraphQL to communicate with its backend.</p>

<p>After logging in, we can see from browser DevTools that a GraphQL request is sent out to retrieve notes.</p>

<p>What should we do? We can take a look at graphql.org. Then we find this page <a href="https://graphql.org/learn/introspection/">Introspection</a>.</p>

<p>Just do everything it said. First, we should ask the GraphQL endpoint what types are available.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">fetch</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://202.38.93.111:15001/graphql</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
  <span class="dl">"</span><span class="s2">headers</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">accept</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json, text/plain, */*</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">accept-language</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">en-US,en;q=0.9,zh-CN;q=0.8,zh;q=0.7</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">content-type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">proxy-connection</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">keep-alive</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">referrer</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">http://202.38.93.111:15001/notes</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">referrerPolicy</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">strict-origin-when-cross-origin</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">body</span><span class="dl">"</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="na">query</span><span class="p">:</span><span class="s2">`{
  __schema {
    types {
      name
    }
  }
}`</span><span class="p">}),</span>
  <span class="dl">"</span><span class="s2">method</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">mode</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">cors</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">credentials</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">include</span><span class="dl">"</span>
<span class="p">});</span>
<span class="c1">// Result:</span>
<span class="p">{</span>
    <span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">__schema</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">types</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Query</span><span class="dl">"</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">GNote</span><span class="dl">"</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Int</span><span class="dl">"</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">String</span><span class="dl">"</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">GUser</span><span class="dl">"</span>
                <span class="p">},</span>
                <span class="p">...</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Note that there’s a GUser named similarly to GNote. So maybe the GUser type is used for describing a user.</p>

<p>Let’s check what fields appear in GUser.</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">fetch</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://202.38.93.111:15001/graphql</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
  <span class="dl">"</span><span class="s2">headers</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">accept</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json, text/plain, */*</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">accept-language</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">en-US,en;q=0.9,zh-CN;q=0.8,zh;q=0.7</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">content-type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">proxy-connection</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">keep-alive</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">referrer</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">http://202.38.93.111:15001/notes</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">referrerPolicy</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">strict-origin-when-cross-origin</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">body</span><span class="dl">"</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="na">query</span><span class="p">:</span><span class="s2">`{
  __type(name: "GUser") {
    name
    fields {
      name
      type {
        name
        kind
      }
    }
  }
}`</span><span class="p">}),</span>
  <span class="dl">"</span><span class="s2">method</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">mode</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">cors</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">credentials</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">include</span><span class="dl">"</span>
<span class="p">});</span>
<span class="c1">// Result:</span>
<span class="p">{</span>
    <span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">__type</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">GUser</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">fields</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">,</span>
                    <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Int</span><span class="dl">"</span><span class="p">,</span>
                        <span class="dl">"</span><span class="s2">kind</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">SCALAR</span><span class="dl">"</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">username</span><span class="dl">"</span><span class="p">,</span>
                    <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">String</span><span class="dl">"</span><span class="p">,</span>
                        <span class="dl">"</span><span class="s2">kind</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">SCALAR</span><span class="dl">"</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">privateEmail</span><span class="dl">"</span><span class="p">,</span>
                    <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">String</span><span class="dl">"</span><span class="p">,</span>
                        <span class="dl">"</span><span class="s2">kind</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">SCALAR</span><span class="dl">"</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>So we know the field which contains email is called <code class="language-plaintext highlighter-rouge">privateEmail</code>.</p>

<p>Next, we should find out what queries are available for us.</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">fetch</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://202.38.93.111:15001/graphql</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
  <span class="dl">"</span><span class="s2">headers</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">accept</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json, text/plain, */*</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">accept-language</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">en-US,en;q=0.9,zh-CN;q=0.8,zh;q=0.7</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">content-type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">proxy-connection</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">keep-alive</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">referrer</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">http://202.38.93.111:15001/notes</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">referrerPolicy</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">strict-origin-when-cross-origin</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">body</span><span class="dl">"</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="na">query</span><span class="p">:</span><span class="s2">`{
  __schema {
    queryType {
      fields {
        name
      }
    }
  }
}`</span><span class="p">}),</span>
  <span class="dl">"</span><span class="s2">method</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">mode</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">cors</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">credentials</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">include</span><span class="dl">"</span>
<span class="p">});</span>
<span class="c1">// Result:</span>
<span class="p">{</span>
    <span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">__schema</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">queryType</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">fields</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">note</span><span class="dl">"</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">notes</span><span class="dl">"</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">user</span><span class="dl">"</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>According to the request for notes, we can know our <code class="language-plaintext highlighter-rouge">userId</code> is 2. So the admin’s is probably 1. Then finally we can write a similar request to get admin’s email.</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">fetch</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://202.38.93.111:15001/graphql</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
  <span class="dl">"</span><span class="s2">headers</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">accept</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json, text/plain, */*</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">accept-language</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">en-US,en;q=0.9,zh-CN;q=0.8,zh;q=0.7</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">content-type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">proxy-connection</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">keep-alive</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">referrer</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">http://202.38.93.111:15001/notes</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">referrerPolicy</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">strict-origin-when-cross-origin</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">body</span><span class="dl">"</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="na">query</span><span class="p">:</span><span class="s2">`{
  user(id: 1){
      privateEmail
  }
}`</span><span class="p">}),</span>
  <span class="dl">"</span><span class="s2">method</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">mode</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">cors</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">credentials</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">include</span><span class="dl">"</span>
<span class="p">});</span>
<span class="c1">// Result:</span>
<span class="p">{</span>
    <span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">user</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">privateEmail</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">flag{dont_let_graphql_l3ak_data_3940369369@hackergame.ustc}</span><span class="dl">"</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="加密的u盘">加密的U盘</h2>

<p>To solve this task, we should find out how does LUKS work. On this <a href="https://gitlab.com/cryptsetup/cryptsetup/-/wikis/FrequentlyAskedQuestions">FAQ Page</a>(I found this through Wikipedia), it describes LUKS as “multiple user keys with one master key”.</p>

<p>That means our data is encrypted with a master key which won’t change unless you reformat the disk, then it uses our user key to encrypt that master key. If we need to change the user key, then it only needs to re-encrypt the master key, instead of re-encrypting the whole disk.</p>

<p>So, if we use the image of first day to get that master key, then use the master key to directly decrypt the second one, we can get the flag.</p>

<p>Easier implementation is just backing up the whole LUKS header of the first image then recover it to the second one. That can be done with these commands.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Setup images as loop device</span>
<span class="nb">sudo </span>losetup <span class="nt">-P</span> /dev/loop101 day1.img
<span class="nb">sudo </span>losetup <span class="nt">-P</span> /dev/loop102 day2.img

<span class="c"># Back up the header of the 1st image</span>
<span class="nb">sudo </span>cryptsetup luksHeaderBackup /dev/loop101p1 <span class="nt">--header-backup-file</span><span class="o">=</span>luks-header

<span class="c"># Then restore to the 2nd image</span>
<span class="nb">sudo </span>cryptsetup luksHeaderRestore /dev/loop102p1 <span class="nt">--header-backup-file</span><span class="o">=</span>luks-header

<span class="c"># Mount the 2nd image with the password of first image</span>
<span class="nb">sudo </span>cryptsetup luksOpen /dev/loop102p2 day2
<span class="nb">mkdir </span>day2
<span class="nb">sudo </span>mount /dev/mapper/day2 day2

<span class="c"># Get the flag</span>
<span class="nb">cat </span>day2/flag.txt
</code></pre></div></div>

<h2 id="阵列恢复大师">阵列恢复大师</h2>

<h3 id="raid-5">RAID-5</h3>

<p>First, we should know <a href="https://en.wikipedia.org/wiki/Standard_RAID_levels#RAID_5">how RAID-5 work</a>.</p>

<p>Then we can get RAID-5 parameters(block size, layout) manually. View these images with a hex editor.</p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211105082446.webp" alt=""></p>

<p>There’s a <code class="language-plaintext highlighter-rouge">EFI PART</code> signature, so we can infer that this disk is using GPT. And this will only occur in the beginning of the logical disk, so we can know that in <code class="language-plaintext highlighter-rouge">3Rl</code> and <code class="language-plaintext highlighter-rouge">60k</code>, one is the first data disk, and another is the first parity disk.</p>

<table>
  <thead>
    <tr>
      <th>3D8</th>
      <th>3Rl</th>
      <th>60k</th>
      <th>IrY</th>
      <th>QjT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td> </td>
      <td>1/P</td>
      <td>1/P</td>
      <td> </td>
      <td> </td>
    </tr>
  </tbody>
</table>

<p>Then we scroll down to 00250000, that’s where plain text begins, so maybe we can get the order here.</p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211105083958.webp" alt=""></p>

<p>Three disks are plain text, but <code class="language-plaintext highlighter-rouge">3D8</code> is something we don’t understand, and QjT is null bytes here.</p>

<p>Doing some calculation, we’ll find out that <code class="language-plaintext highlighter-rouge">3D8@250000</code> is actually the xor parity block of other disks. Then let’s scroll down and see when will the parity block end.</p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211105091417.webp" alt=""></p>

<p>It ends at 00260000. So the block size is 10000h = 64KB.</p>

<p>Then how can we know the order? Let’s observe the parity block moving pattern first.</p>

<p>Using the same method, we can get such information.</p>

<table>
  <thead>
    <tr>
      <th>start addr</th>
      <th>3D8</th>
      <th>3Rl</th>
      <th>60k</th>
      <th>IrY</th>
      <th>QjT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>000000</td>
      <td> </td>
      <td>1/P</td>
      <td>1/P</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>……</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>250000</td>
      <td>P</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>260000</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>P</td>
      <td> </td>
    </tr>
    <tr>
      <td>270000</td>
      <td> </td>
      <td>P</td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>280000</td>
      <td> </td>
      <td> </td>
      <td>P</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>290000</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>P</td>
    </tr>
    <tr>
      <td>2A0000</td>
      <td>P</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>2B0000</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>P</td>
      <td> </td>
    </tr>
    <tr>
      <td>2C0000</td>
      <td> </td>
      <td>P</td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>2D0000</td>
      <td> </td>
      <td> </td>
      <td>P</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>2E0000</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>P</td>
    </tr>
  </tbody>
</table>

<p>And we can also work out the parity block at 000000.</p>

<table>
  <thead>
    <tr>
      <th>start addr</th>
      <th>3D8</th>
      <th>3Rl</th>
      <th>60k</th>
      <th>IrY</th>
      <th>QjT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>000000</td>
      <td> </td>
      <td>1</td>
      <td>P</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>……</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>250000</td>
      <td>P</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>260000</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>P</td>
      <td> </td>
    </tr>
    <tr>
      <td>270000</td>
      <td> </td>
      <td>P</td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>280000</td>
      <td> </td>
      <td> </td>
      <td>P</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>290000</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>P</td>
    </tr>
    <tr>
      <td>2A0000</td>
      <td>P</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>2B0000</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>P</td>
      <td> </td>
    </tr>
    <tr>
      <td>2C0000</td>
      <td> </td>
      <td>P</td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>2D0000</td>
      <td> </td>
      <td> </td>
      <td>P</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>2E0000</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>P</td>
    </tr>
  </tbody>
</table>

<p>Referring to <a href="http://www.reclaime-pro.com/posters/raid-layouts.pdf">RAID Layout</a>, there are two possible ways to rebuild currently.</p>

<ul>
  <li>64KB, left symmetric, order: <code class="language-plaintext highlighter-rouge">3RI</code>,<code class="language-plaintext highlighter-rouge">IrY</code>,<code class="language-plaintext highlighter-rouge">3D8</code>,<code class="language-plaintext highlighter-rouge">QjT</code>,<code class="language-plaintext highlighter-rouge">60k</code>
</li>
  <li>64KB, left asymmetric, order: <code class="language-plaintext highlighter-rouge">3RI</code>,<code class="language-plaintext highlighter-rouge">IrY</code>,<code class="language-plaintext highlighter-rouge">3D8</code>,<code class="language-plaintext highlighter-rouge">QjT</code>,<code class="language-plaintext highlighter-rouge">60k</code>
</li>
</ul>

<p>Let’s rearrange these disks for further checks.</p>

<table>
  <thead>
    <tr>
      <th>start addr</th>
      <th>3Rl</th>
      <th>IrY</th>
      <th>3D8</th>
      <th>QjT</th>
      <th>60k</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>000000</td>
      <td>1</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>P</td>
    </tr>
    <tr>
      <td>……</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>250000</td>
      <td> </td>
      <td> </td>
      <td>P</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>260000</td>
      <td> </td>
      <td>P</td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>270000</td>
      <td>P</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>280000</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>P</td>
    </tr>
    <tr>
      <td>290000</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>P</td>
      <td> </td>
    </tr>
    <tr>
      <td>2A0000</td>
      <td> </td>
      <td> </td>
      <td>P</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>2B0000</td>
      <td> </td>
      <td>P</td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>2C0000</td>
      <td>P</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>2D0000</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>P</td>
    </tr>
    <tr>
      <td>2E0000</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>P</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<p>Remember the plain text content? We can use it to find out the actual way. It looks like GRUB makefile, so let’s find it on the Internet.</p>

<p><a href="https://git.parrotsec.org/packages/debian/grub2/-/raw/upstream/Makefile.in">Here</a> it is.</p>

<p>Then we just need to find if the data block after QjT@280000 is 60k@290000 (left symmetric) or 3Rl@290000 (left asymmetric).</p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211105100347.webp" alt=""></p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211105100412.png" alt=""></p>

<p>So it should be left symmetric.</p>

<p>Then we can use DiskGenius to rebuild it.</p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211105100911.webp" alt=""></p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211105101033.webp" alt=""></p>

<p>Then we can export and get flag.</p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211105101358.webp" alt=""></p>

<h3 id="raid-0">RAID-0</h3>

<p>Similarly, open all the images with hex editor.</p>

<p>And the <code class="language-plaintext highlighter-rouge">EFI PART</code> signature appears in <code class="language-plaintext highlighter-rouge">wlO</code>, so it’s the first disk.</p>

<p>Then we browse this disk, found out there are some data before 1DFFF0 but immediately stops at 1E0000. So we can infer that it’s a block end.</p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211105101955.webp" alt=""></p>

<p>Let’s jump every disk to 1DFFF0.</p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211105102255.webp" alt=""></p>

<p>Only <code class="language-plaintext highlighter-rouge">jCC</code> and <code class="language-plaintext highlighter-rouge">1GH</code> have data.</p>

<p>In RAID-0, data distributes like this:</p>

<table>
  <thead>
    <tr>
      <th>Disk 1</th>
      <th>Disk 2</th>
      <th>Disk 3</th>
      <th>Disk 4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
    </tr>
    <tr>
      <td>9</td>
      <td>10</td>
      <td>11</td>
      <td>12</td>
    </tr>
  </tbody>
</table>

<p>So it means <code class="language-plaintext highlighter-rouge">jCC</code> and <code class="language-plaintext highlighter-rouge">1GH</code> should be Disk 2 &amp; 3, though we don’t know exactly which one should be in which place.</p>

<p>But it shouldn’t end immediately, if the data size isn’t exactly the multiples of block size.</p>

<p>So let’s jump backwards in other disks.</p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211105103232.webp" alt=""></p>

<p>Only the disk <code class="language-plaintext highlighter-rouge">5qi</code> has data in 1C0000~1DFFF0. So it should be the Disk 4. And we can infer from this that the block size is 20000h = 128KB.</p>

<p>Let’s find more information.</p>

<p>Surprisingly, there’s some plain text at <code class="language-plaintext highlighter-rouge">wlO@8C0000</code>. Similarly, let’s jump every disk to that position.</p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211105104010.webp" alt=""></p>

<p>Only <code class="language-plaintext highlighter-rouge">ID7</code> has something before 8C0000, so that should be the Disk 8 according to RAID-0 structure.</p>

<p>Now we know:</p>

<table>
  <thead>
    <tr>
      <th>Disk 1</th>
      <th>Disk 2</th>
      <th>Disk 3</th>
      <th>Disk 4</th>
      <th>Disk 5</th>
      <th>Disk 6</th>
      <th>Disk 7</th>
      <th>Disk 8</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>wlO</td>
      <td>jCC/1GH</td>
      <td>jCC/1GH</td>
      <td>5qi</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>ID7</td>
    </tr>
  </tbody>
</table>

<p>Then let’s try if we can decide the order of other disks.</p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211105104458.webp" alt="">
<img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211105104702.webp" alt=""></p>

<p>Here, <code class="language-plaintext highlighter-rouge">jCC</code> is more likely to be Disk 2, and <code class="language-plaintext highlighter-rouge">1GH</code> is more likely to be Disk 3.</p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211105105009.webp" alt=""></p>

<p>And <code class="language-plaintext highlighter-rouge">d3B</code> should be Disk 5.</p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211105105457.webp" alt="">
<img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211105105614.webp" alt=""></p>

<p><code class="language-plaintext highlighter-rouge">eRL</code> should be Disk 6, and <code class="language-plaintext highlighter-rouge">RAp</code> should be Disk 7.</p>

<p>So that’s all, the order is:</p>

<table>
  <thead>
    <tr>
      <th>Disk 1</th>
      <th>Disk 2</th>
      <th>Disk 3</th>
      <th>Disk 4</th>
      <th>Disk 5</th>
      <th>Disk 6</th>
      <th>Disk 7</th>
      <th>Disk 8</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>wlO</td>
      <td>jCC</td>
      <td>1GH</td>
      <td>5qi</td>
      <td>d3B</td>
      <td>eRL</td>
      <td>RAp</td>
      <td>ID7</td>
    </tr>
  </tbody>
</table>

<p>Rebuild in DiskGenius</p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211105105951.webp" alt=""></p>

<p>But we can’t see any files in it. Go to <code class="language-plaintext highlighter-rouge">Sector Editor</code>, the head of this partition is XFSB, so that means its filesystem is XFS. DiskGenius doesn’t support this filesystem, then we need to mount it in Linux.</p>

<p>Clone the virtual RAID to a blank image.</p>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211105111055.webp" alt=""></p>

<p>Then use the following commands in linux:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>raid0
<span class="nb">sudo </span>losetup <span class="nt">-P</span> /dev/loop100 awa.img
<span class="nb">sudo </span>mount <span class="nt">-t</span> xfs /dev/loop100p1 raid0
<span class="nb">cd </span>raid0
python3 getflag.py
</code></pre></div></div>

<p><img src="https://catmeowimg.oss-cn-chengdu.aliyuncs.com/img/20211105111842.png" alt=""></p>

<p>Finally, we got the flag.</p>

      </article>

      

      

      

      <ul class="pagination blog-pager">
        
        <li class="page-item previous">
          <a class="page-link" href="/web/writeup/hackergame/2021/11/01/hackergame2021-writeup-part-1.html" data-toggle="tooltip" data-placement="top" title="Hackergame 2021 Writeup Part 1(Entry level)">← Previous Post</a>
        </li>
        
        
      </ul>
      

    </div>
  </div>
</div>


  <footer>
  <div class="container-md beautiful-jekyll-footer">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
      <ul class="list-inline text-center footer-links"></ul>

      
      <p class="copyright text-muted">
      
      2021

      

      
      </p>
      <!-- Please don't remove this, keep my open source work credited :) -->
      <p class="theme-by text-muted">
        Powered by
        <a href="https://beautifuljekyll.com">Beautiful Jekyll</a>
      </p>
      </div>
    </div>
  </div>
</footer>


  
  
    
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>


  
    
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>


  
    
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>


  



  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script src="/web/assets/js/beautifuljekyll.js"></script>
    
  









</body>
</html>
